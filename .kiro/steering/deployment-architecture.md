# éƒ¨ç½²æ¶æ„å¿«é€Ÿå‚è€ƒ - 100% Cloudflare

## æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·è¯·æ±‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Cloudflare CDN (è¾¹ç¼˜å±‚)                     â”‚
â”‚  - å…¨çƒ CDN åŠ é€Ÿ (300+ æ•°æ®ä¸­å¿ƒ)                              â”‚
â”‚  - DDoS é˜²æŠ¤                                                 â”‚
â”‚  - SSL/TLS ç»ˆæ­¢                                              â”‚
â”‚  - æ™ºèƒ½è·¯ç”±                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Cloudflare Pages (å‰ç«¯å±‚)                   â”‚
â”‚  - Next.js SSR/SSG é¡µé¢                                      â”‚
â”‚  - é™æ€èµ„æºæ‰˜ç®¡                                               â”‚
â”‚  - Pages Functions (è¾¹ç¼˜è®¡ç®—)                                â”‚
â”‚  - å¤šè¯­è¨€è·¯ç”± (20+ è¯­è¨€)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Cloudflare Workers (API å±‚)                 â”‚
â”‚  - Hono æ¡†æ¶                                                 â”‚
â”‚  - JWT è®¤è¯ç³»ç»Ÿ                                              â”‚
â”‚  - Points System V2 API                                      â”‚
â”‚  - ä¸šåŠ¡é€»è¾‘å¤„ç†                                               â”‚
â”‚  - å›¾ç‰‡ç”Ÿæˆ API                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloudflare D1â”‚ Cloudflare R2â”‚ Cloudflare KVâ”‚ Durable Obj. â”‚
â”‚  (æ•°æ®åº“)     â”‚  (å¯¹è±¡å­˜å‚¨)   â”‚  (ç¼“å­˜/ä¼šè¯)  â”‚  (æœ‰çŠ¶æ€)     â”‚
â”‚              â”‚              â”‚              â”‚              â”‚
â”‚ â€¢ ç”¨æˆ·æ•°æ®    â”‚ â€¢ ç”Ÿæˆå›¾ç‰‡    â”‚ â€¢ JWT ä¼šè¯   â”‚ â€¢ å®æ—¶è®¡æ•°    â”‚
â”‚ â€¢ ç§¯åˆ†è®°å½•    â”‚ â€¢ é™æ€æ–‡ä»¶    â”‚ â€¢ ç¼“å­˜æ•°æ®   â”‚ â€¢ WebSocket  â”‚
â”‚ â€¢ ä½¿ç”¨å†å²    â”‚ â€¢ å¤§æ–‡ä»¶     â”‚ â€¢ é™æµè®¡æ•°   â”‚ â€¢ çŠ¶æ€ç®¡ç†    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

**æœ¬é¡¹ç›®é‡‡ç”¨ 100% Cloudflare åŸç”Ÿæ¶æ„**ï¼Œæ— ä»»ä½•å¤–éƒ¨ä¾èµ–ã€‚

### æŠ€æœ¯æ ˆ
- **å‰ç«¯**: Cloudflare Pages + Next.js 14
- **API**: Cloudflare Workers + Hono
- **æ•°æ®åº“**: Cloudflare D1 + Drizzle ORM
- **è®¤è¯**: JWT + Cloudflare KV
- **å­˜å‚¨**: Cloudflare R2
- **ç¼“å­˜**: Cloudflare KV

### å·²ç§»é™¤çš„æ—§æŠ€æœ¯
- âŒ Vercel (å·²ç§»é™¤)
- âŒ Neon PostgreSQL (å·²ç§»é™¤)
- âŒ Prisma ORM (å·²ç§»é™¤)
- âŒ NextAuth (å·²ç§»é™¤)

---

## ğŸ“‹ éƒ¨ç½²å†³ç­–

### æ‰€æœ‰åŠŸèƒ½éƒ½éƒ¨ç½²åˆ° Cloudflare

```
åŠŸèƒ½ç±»å‹
    â†“
å‰ç«¯é¡µé¢ï¼Ÿ â†’ Cloudflare Pages âœ…
    â†“
API æ¥å£ï¼Ÿ â†’ Cloudflare Workers âœ…
    â†“
æ•°æ®åº“ï¼Ÿ â†’ Cloudflare D1 âœ…
    â†“
æ–‡ä»¶å­˜å‚¨ï¼Ÿ â†’ Cloudflare R2 âœ…
    â†“
ç¼“å­˜/ä¼šè¯ï¼Ÿ â†’ Cloudflare KV âœ…
```

**ç®€å•è§„åˆ™**ï¼šæ‰€æœ‰ä¸œè¥¿éƒ½åœ¨ Cloudflareï¼

---

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### å¼€å‘
```bash
# å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨
npm run dev

# å¯åŠ¨ Worker æœ¬åœ°å¼€å‘
cd worker
wrangler dev
```

### æ„å»º
```bash
# æ„å»º Next.js åº”ç”¨
npm run build

# æ„å»º Worker
cd worker
wrangler deploy --dry-run
```

### æ•°æ®åº“
```bash
# è¿è¡Œ D1 è¿ç§»
cd worker
wrangler d1 migrations apply flux-ai --remote

# æŸ¥è¯¢ D1 æ•°æ®åº“
wrangler d1 execute flux-ai --remote --command "SELECT * FROM users LIMIT 10;"

# æœ¬åœ° D1 å¼€å‘
wrangler d1 execute flux-ai --local --command "SELECT * FROM users;"
```

### éƒ¨ç½²
```bash
# éƒ¨ç½² Worker
cd worker
wrangler deploy --env production

# æ¨é€ä»£ç ï¼ˆPages è‡ªåŠ¨éƒ¨ç½²ï¼‰
git push origin main

# æŸ¥çœ‹ Worker æ—¥å¿—
wrangler tail --env production
```

---

## ğŸŒ ç¯å¢ƒå˜é‡

### Cloudflare Pages éœ€è¦é…ç½®

```env
# Replicate API
REPLICATE_API_TOKEN=ä½ çš„_Token

# Stripe æ”¯ä»˜
STRIPE_SECRET_KEY=ä½ çš„_Secret_Key
STRIPE_WEBHOOK_SECRET=ä½ çš„_Webhook_Secret
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=ä½ çš„_Publishable_Key

# Worker URL
NEXT_PUBLIC_WORKER_URL=https://api.flux-ai-img.com

# Base URLs
NEXT_PUBLIC_BASE_URL=https://flux-ai-img.com
NEXT_PUBLIC_APP_URL=https://flux-ai-img.com

# å…¶ä»–
NEXT_TELEMETRY_DISABLED=1
IP_SALT=ä½ çš„_Salt
FINGERPRINT_SALT=ä½ çš„_Salt
```

### Cloudflare Workers éœ€è¦é…ç½®

```bash
# ä½¿ç”¨ wrangler secret å‘½ä»¤é…ç½®
wrangler secret put JWT_SECRET --env production
wrangler secret put IP_SALT --env production
wrangler secret put REPLICATE_API_TOKEN --env production
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŠ¿

### å…¨çƒè¾¹ç¼˜ç½‘ç»œ
- âœ… 300+ æ•°æ®ä¸­å¿ƒ
- âœ… å¹³å‡å“åº”æ—¶é—´ < 50ms
- âœ… è‡ªåŠ¨ DDoS é˜²æŠ¤
- âœ… æ— é™å¸¦å®½

### è¾¹ç¼˜è®¡ç®—
- âœ… Workers åœ¨è¾¹ç¼˜æ‰§è¡Œ
- âœ… D1 æ•°æ®åº“è¾¹ç¼˜å¤åˆ¶
- âœ… KV å…¨çƒåˆ†å¸ƒ
- âœ… é›¶å†·å¯åŠ¨

### æˆæœ¬ä¼˜åŒ–
- âœ… Pages: å…è´¹ï¼ˆæ— é™è¯·æ±‚ï¼‰
- âœ… Workers: å…è´¹å±‚ 100,000 è¯·æ±‚/å¤©
- âœ… D1: å…è´¹å±‚ 5GB å­˜å‚¨
- âœ… R2: å…è´¹å±‚ 10GB å­˜å‚¨
- âœ… KV: å…è´¹å±‚ 1GB å­˜å‚¨

**é¢„è®¡æœˆæˆæœ¬**: $0 (å…è´¹å±‚è¶³å¤Ÿ)

---

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### è®¤è¯ç³»ç»Ÿ
- âœ… JWT è®¤è¯ï¼ˆjose åº“ï¼‰
- âœ… HttpOnly Cookies
- âœ… Token Rotation
- âœ… ä¼šè¯ç®¡ç† (KV)

### æ•°æ®å®‰å…¨
- âœ… æ‰€æœ‰æ•°æ®åŠ å¯†ä¼ è¾“ (HTTPS)
- âœ… å¯†ç  bcrypt å“ˆå¸Œ
- âœ… SQL æ³¨å…¥é˜²æŠ¤ (Drizzle ORM)
- âœ… XSS é˜²æŠ¤

### è®¿é—®æ§åˆ¶
- âœ… Rate Limiting (KV)
- âœ… IP è¿½è¸ª
- âœ… æŒ‡çº¹è¯†åˆ«
- âœ… ä½¿ç”¨é‡é™åˆ¶

---

## ğŸ§ª æµ‹è¯•æ¸…å•

### éƒ¨ç½²åæµ‹è¯•

1. **Worker API**
   ```bash
   curl https://api.flux-ai-img.com/
   ```
   é¢„æœŸ: è¿”å›å¥åº·æ£€æŸ¥ä¿¡æ¯

2. **ä¸»ç«™è®¿é—®**
   - è®¿é—®: https://flux-ai-img.com
   - æ£€æŸ¥: é¡µé¢åŠ è½½ã€æ ·å¼ã€å¤šè¯­è¨€

3. **æœªç™»å½•ç”¨æˆ·**
   - ç”Ÿæˆå›¾ç‰‡ â†’ æˆåŠŸ
   - åˆ·æ–°é¡µé¢ â†’ æ˜¾ç¤º `0 / 1`
   - å†æ¬¡ç”Ÿæˆ â†’ æç¤ºé™åˆ¶

4. **ç™»å½•ç”¨æˆ·**
   - æ³¨å†Œè´¦å· â†’ è·å¾— 3 ç§¯åˆ†
   - ç”Ÿæˆå›¾ç‰‡ â†’ æ‰£é™¤ 1 ç§¯åˆ†
   - æ£€æŸ¥ä½™é¢ â†’ æ˜¾ç¤º 2 ç§¯åˆ†

---

## ğŸ†˜ æ•…éšœæ’é™¤

### Worker éƒ¨ç½²å¤±è´¥
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
cd worker
wrangler deploy --env production --verbose

# æ£€æŸ¥ wrangler.toml é…ç½®
cat wrangler.toml
```

### Pages æ„å»ºå¤±è´¥
```bash
# æœ¬åœ°æµ‹è¯•æ„å»º
npm run build

# æ£€æŸ¥æ„å»ºæ—¥å¿—
# åœ¨ Cloudflare Dashboard â†’ Pages â†’ Deployments
```

### æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æµ‹è¯• D1 è¿æ¥
cd worker
wrangler d1 execute flux-ai --remote --command "SELECT 1;"

# æŸ¥çœ‹æ•°æ®åº“åˆ—è¡¨
wrangler d1 list
```

### è®¤è¯å¤±è´¥
```bash
# æŸ¥çœ‹ Worker æ—¥å¿—
cd worker
wrangler tail --env production

# æ£€æŸ¥ JWT_SECRET æ˜¯å¦é…ç½®
wrangler secret list --env production
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **éƒ¨ç½²æŒ‡å—**: `CLOUDFLARE_DEPLOYMENT_GUIDE.md`
- **æ¶æ„è¯´æ˜**: `CLOUDFLARE_ARCHITECTURE.md`
- **æœ€ç»ˆæ€»ç»“**: `FINAL_DEPLOYMENT_SUMMARY.md`
- **Worker é…ç½®**: `worker/wrangler.toml`
- **æ•°æ®åº“è¿ç§»**: `migrations/d1-points-system-v2-incremental.sql`

---

## âœ… ä¼˜åŠ¿æ€»ç»“

### æ€§èƒ½
- âš¡ å…¨çƒè¾¹ç¼˜ç½‘ç»œ
- âš¡ é›¶å†·å¯åŠ¨
- âš¡ è‡ªåŠ¨æ‰©å±•
- âš¡ æ™ºèƒ½ç¼“å­˜

### æˆæœ¬
- ğŸ’° å…è´¹å±‚è¶³å¤Ÿä½¿ç”¨
- ğŸ’° æŒ‰éœ€ä»˜è´¹
- ğŸ’° æ— éšè—è´¹ç”¨
- ğŸ’° æ¯”ä¼ ç»Ÿæ¶æ„ä¾¿å®œ 90%

### å¼€å‘
- ğŸš€ å¿«é€Ÿéƒ¨ç½²
- ğŸš€ é›¶é…ç½®
- ğŸš€ è‡ªåŠ¨ CI/CD
- ğŸš€ å®æ—¶æ—¥å¿—

### å®‰å…¨
- ğŸ”’ è‡ªåŠ¨ DDoS é˜²æŠ¤
- ğŸ”’ å…¨çƒ WAF
- ğŸ”’ è‡ªåŠ¨ SSL
- ğŸ”’ è¾¹ç¼˜åŠ å¯†

---

**è®°ä½**: 100% Cloudflare åŸç”Ÿæ¶æ„ï¼Œæ— ä»»ä½•å¤–éƒ¨ä¾èµ–ï¼
