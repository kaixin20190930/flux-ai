# ğŸš€ Flux AI - éƒ¨ç½²çŠ¶æ€

## ğŸ“Š å½“å‰çŠ¶æ€

**ç‰ˆæœ¬**: Points System V2.0  
**æœ€åæ›´æ–°**: 2024-12-18  
**çŠ¶æ€**: âœ… ç”Ÿäº§é—®é¢˜å·²ä¿®å¤ï¼Œå¾…éƒ¨ç½²éªŒè¯

---

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. Points System V2 é‡æ„
- âœ… æœªæ³¨å†Œç”¨æˆ·ï¼šæ¯å¤© 1 æ¬¡å…è´¹ç”Ÿæˆï¼ˆä»… flux-schnellï¼‰
- âœ… æ³¨å†Œç”¨æˆ·ï¼šåˆå§‹ 3 ç§¯åˆ†ï¼Œæ— å…è´¹é¢åº¦
- âœ… IP + æŒ‡çº¹è¿½è¸ªç³»ç»Ÿ
- âœ… D1 æ•°æ®åº“è¿ç§»å®Œæˆ
- âœ… Worker V2 API å®ç°å®Œæˆ

### 2. å‰ç«¯ä¼˜åŒ–
- âœ… UI å¸ƒå±€ä¼˜åŒ–ï¼ˆç§»é™¤æ»šåŠ¨æ¡ï¼‰
- âœ… æ³¨å†Œæ¿€åŠ±æµ®åŠ¨å¡ç‰‡
- âœ… æŒ‡çº¹æŒä¹…åŒ–ï¼ˆlocalStorageï¼‰
- âœ… IP åœ°å€æ ‡å‡†åŒ–

### 3. æµ‹è¯•éªŒè¯
- âœ… æœ¬åœ°å¼€å‘ç¯å¢ƒæµ‹è¯•é€šè¿‡
- âœ… æœªç™»å½•ç”¨æˆ·å…è´¹é¢åº¦æµ‹è¯•é€šè¿‡
- âœ… ç™»å½•ç”¨æˆ·ç§¯åˆ†æ‰£é™¤æµ‹è¯•é€šè¿‡
- âœ… é¡µé¢åˆ·æ–°çŠ¶æ€ä¿æŒæµ‹è¯•é€šè¿‡

---

## âœ… ç”Ÿäº§ç¯å¢ƒé—®é¢˜å·²ä¿®å¤

### é—®é¢˜ 1ï¼šWorker URL é…ç½® âœ…
**ç°è±¡**: å‰ç«¯è°ƒç”¨é”™è¯¯çš„ Worker URLï¼ˆå¼€å‘ç¯å¢ƒï¼‰  
**ä¿®å¤**: å·²æ›´æ–° `hooks/useImageGeneration.tsx`ï¼Œä½¿ç”¨åŸºäºåŸŸåçš„è‡ªåŠ¨åˆ¤æ–­  
**æ–¹æ¡ˆ**: Cloudflare Pages å…¼å®¹æ–¹å¼ï¼Œæ— éœ€é…ç½®ç¯å¢ƒå˜é‡

### é—®é¢˜ 2ï¼šæ•°æ®åº“ Schema âœ…
**ç°è±¡**: å¼€å‘å’Œç”Ÿäº§æ•°æ®åº“éƒ½ç¼ºå°‘ `password_hash` å­—æ®µ  
**ä¿®å¤**: å·²åœ¨ä¸¤ä¸ªæ•°æ®åº“æ‰§è¡Œè¿ç§»è„šæœ¬  
**ç»“æœ**: 
- âœ… flux-ai-dev: å·²æ·»åŠ å­—æ®µ
- âœ… flux-ai: å·²æ·»åŠ å­—æ®µï¼ˆ102 è¡Œæ•°æ®å·²æ›´æ–°ï¼‰

---

## ğŸ“‹ ç”Ÿäº§éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤ 1ï¼šä¿®å¤æ•°æ®åº“
```bash
./scripts/fix-production-issues.sh
```

### æ­¥éª¤ 2ï¼šé…ç½®ç¯å¢ƒå˜é‡
åœ¨ Vercel Dashboard ä¸­è®¾ç½®ï¼š
```
NEXT_PUBLIC_WORKER_URL=https://api.flux-ai-img.com
```

### æ­¥éª¤ 3ï¼šé‡æ–°éƒ¨ç½²
```bash
git push origin main
```

### æ­¥éª¤ 4ï¼šéªŒè¯
- è®¿é—® https://flux-ai-img.com/en/auth
- æµ‹è¯•æ³¨å†ŒåŠŸèƒ½
- æ£€æŸ¥ Network è¯·æ±‚ URL

è¯¦ç»†æ­¥éª¤è¯·å‚è€ƒï¼š`PRODUCTION_FIX_GUIDE.md`

---

## ğŸ“ æ ¸å¿ƒæ–‡ä»¶

### å‰ç«¯
- `hooks/useImageGeneration.tsx` - å›¾ç‰‡ç”Ÿæˆ Hookï¼ˆå·²ä¿®å¤ Worker URLï¼‰
- `components/AIImageGenerator.tsx` - ä¸»ç•Œé¢ç»„ä»¶

### Worker API
- `worker/index-hono.ts` - Hono åº”ç”¨å…¥å£
- `worker/handlers/getUserStatusV2.ts` - ç”¨æˆ·çŠ¶æ€æŸ¥è¯¢
- `worker/handlers/createGenerationV2.ts` - å›¾ç‰‡ç”Ÿæˆå¤„ç†
- `worker/routes/generation.ts` - è·¯ç”±é…ç½®

### æ•°æ®åº“
- `migrations/d1-points-system-v2.sql` - ä¸»è¿ç§»è„šæœ¬
- `migrations/d1-add-password-hash.sql` - ä¿®å¤è„šæœ¬

### é…ç½®
- `worker/wrangler.toml` - Cloudflare Worker é…ç½®
- `.env.example` - ç¯å¢ƒå˜é‡ç¤ºä¾‹

---

## ğŸ” æ¶æ„è¯´æ˜

### éƒ¨ç½²æ¶æ„
```
ç”¨æˆ·è¯·æ±‚
    â†“
Cloudflare CDN
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Cloudflare Pagesï¼ˆå‰ç«¯ï¼‰         â”‚
â”‚  - Next.js åº”ç”¨                      â”‚
â”‚  - å¤šè¯­è¨€è·¯ç”±                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Cloudflare Workersï¼ˆAPIï¼‰          â”‚
â”‚  - Hono æ¡†æ¶                        â”‚
â”‚  - Points System V2                 â”‚
â”‚  - JWT è®¤è¯                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloudflare D1â”‚ Cloudflare R2â”‚ Cloudflare KVâ”‚
â”‚  (æ•°æ®åº“)     â”‚  (å¯¹è±¡å­˜å‚¨)   â”‚  (ç¼“å­˜/ä¼šè¯)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®åº“è¡¨ç»“æ„
- `users` - ç”¨æˆ·ä¿¡æ¯ï¼ˆemail, password_hash, pointsï¼‰
- `daily_usage` - æ¯æ—¥ä½¿ç”¨è®°å½•ï¼ˆIP + æŒ‡çº¹è¿½è¸ªï¼‰
- `generation_history` - ç”Ÿæˆå†å²
- `transactions` - ç§¯åˆ†äº¤æ˜“è®°å½•

---

## ğŸ“š æ–‡æ¡£ç´¢å¼•

### éƒ¨ç½²ç›¸å…³
- `PRODUCTION_DEPLOYMENT_CHECKLIST.md` - å®Œæ•´éƒ¨ç½²æ£€æŸ¥æ¸…å•
- `PRODUCTION_FIX_GUIDE.md` - ç”Ÿäº§é—®é¢˜ä¿®å¤æŒ‡å—
- `CLOUDFLARE_ARCHITECTURE.md` - Cloudflare æ¶æ„è¯´æ˜

### åŠŸèƒ½è¯´æ˜
- `POINTS_SYSTEM_V2_SUMMARY.md` - ç§¯åˆ†ç³»ç»Ÿè¯¦ç»†è¯´æ˜
- `WHAT_WE_BUILT.md` - é¡¹ç›®åŠŸèƒ½æ€»è§ˆ
- `README.md` - é¡¹ç›®ä¸»æ–‡æ¡£

### å¼€å‘è§„èŒƒ
- `.kiro/steering/deployment-architecture.md` - éƒ¨ç½²æ¶æ„è§„èŒƒ
- `.kiro/steering/ai-development-rules.md` - AI å¼€å‘è§„èŒƒ
- `.kiro/steering/cloudflare-first-architecture.md` - Cloudflare ä¼˜å…ˆæ¶æ„

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³æ‰§è¡Œ**ï¼šè¿è¡Œ `./scripts/fix-production-issues.sh` ä¿®å¤æ•°æ®åº“
2. **é…ç½®ç¯å¢ƒå˜é‡**ï¼šåœ¨ Vercel è®¾ç½® `NEXT_PUBLIC_WORKER_URL`
3. **é‡æ–°éƒ¨ç½²**ï¼š`git push origin main`
4. **éªŒè¯åŠŸèƒ½**ï¼šæµ‹è¯•æ³¨å†Œå’Œç”ŸæˆåŠŸèƒ½
5. **ç›‘æ§æ—¥å¿—**ï¼šæ£€æŸ¥ Worker å’Œ Vercel æ—¥å¿—

---

## ğŸ“ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: æ³¨å†Œå¤±è´¥ï¼Œæç¤º "password_hash" å­—æ®µä¸å­˜åœ¨**  
A: è¿è¡Œ `./scripts/fix-production-issues.sh` æ·»åŠ å­—æ®µ

**Q: å‰ç«¯è°ƒç”¨é”™è¯¯çš„ Worker URL**  
A: åœ¨ Vercel è®¾ç½® `NEXT_PUBLIC_WORKER_URL=https://api.flux-ai-img.com`

**Q: é¡µé¢åˆ·æ–°åçŠ¶æ€ä¸æ­£ç¡®**  
A: å·²ä¿®å¤ï¼Œç¡®ä¿ä½¿ç”¨æœ€æ–°ä»£ç 

### æŸ¥çœ‹æ—¥å¿—
```bash
# Worker æ—¥å¿—
cd worker && wrangler tail

# Vercel æ—¥å¿—
vercel logs
```

---

**ç»´æŠ¤è€…**: Flux AI Team  
**è”ç³»æ–¹å¼**: æŸ¥çœ‹ README.md
